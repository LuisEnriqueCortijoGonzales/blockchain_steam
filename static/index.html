<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Blockchain Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #0f172a; color: #e2e8f0; }
    header { padding: 16px; background: #111827; display:flex; gap:24px; }
    main { display:grid; grid-template-columns: 1fr 1fr; gap:16px; padding:16px; }
    .card { background:#1f2937; border-radius:10px; padding:12px; }
    input, button { padding:8px; margin:4px 0; width:100%; }
    .mono { font-family: monospace; word-break: break-all; }
  </style>
</head>
<body>
<header>
  <div>Altura: <strong id="height">0</strong></div>
  <div>Mempool: <strong id="mempool">0</strong></div>
  <div>Tip: <span id="tip" class="mono"></span></div>
</header>
<main>
  <section class="card">
    <h3>Crear Wallet</h3>
    <input id="walletName" placeholder="nombre wallet" />
    <button onclick="createWallet()">Crear</button>
    <pre id="walletResult"></pre>
  </section>
  <section class="card">
    <h3>Crear Transacci√≥n</h3>
    <input id="from" placeholder="wallet_name" />
    <input id="to" placeholder="to_address" />
    <input id="amount" type="number" step="0.0001" placeholder="amount" />
    <button onclick="createTx()">Enviar</button>
    <pre id="txResult"></pre>
    <button onclick="mineNow()">Minar ahora</button>
  </section>
  <section class="card" style="grid-column:1/3">
    <h3>Bloques (tiempo real)</h3>
    <pre id="chain" style="max-height:360px;overflow:auto"></pre>
  </section>
</main>
<script>
async function createWallet() {
  const name = document.getElementById('walletName').value;
  const r = await fetch('/api/wallet', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({name})});
  document.getElementById('walletResult').textContent = JSON.stringify(await r.json(), null, 2);
}
async function createTx() {
  const body = {
    wallet_name: document.getElementById('from').value,
    to_address: document.getElementById('to').value,
    amount: Number(document.getElementById('amount').value)
  };
  const r = await fetch('/api/tx', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
  document.getElementById('txResult').textContent = JSON.stringify(await r.json(), null, 2);
}
async function mineNow() {
  await fetch('/api/mine', {method:'POST'});
}
async function refreshState(){
  const r = await fetch('/api/state');
  const s = await r.json();
  document.getElementById('height').textContent = s.height;
  document.getElementById('mempool').textContent = s.mempool;
  document.getElementById('tip').textContent = s.tip;
  document.getElementById('chain').textContent = JSON.stringify(s.chain.slice(-5), null, 2);
}
setInterval(refreshState, 1000);
refreshState();
</script>
</body>
</html>
